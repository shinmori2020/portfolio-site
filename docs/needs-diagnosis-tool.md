# ニーズ診断ツール - 概要と技術仕様

## 📊 システム概要

`needs-diagnosis.html`は、10個の質問を通じてユーザーのニーズを診断し、最適なWeb制作プランを提案する診断ツールです。

### 主な機能
- ✅ 10問の段階的な質問フロー
- ✅ プログレスバー表示
- ✅ 自動保存機能（7日間保持）
- ✅ ブラウザバック/フォワード対応
- ✅ 診断結果の料金計算機連携
- ✅ 結果のメール送信機能
- ✅ レスポンシブ対応

## 🎨 デザイン仕様

### カラーパレット
```css
/* CSS変数定義 */
--primary-color: #00ff88;      /* アクセントカラー（ネオングリーン） */
--secondary-color: #0a0a0a;    /* 背景色（ダークブラック） */
--text-primary: #ffffff;       /* メインテキスト */
--text-secondary: #a0a0a0;     /* サブテキスト */
--transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);  /* アニメーション */
```

### レイアウト構造
```
┌─────────────────────────────────────────┐
│            ヘッダー（固定）               │
├─────────────────────────────────────────┤
│         プログレスバー (0-100%)          │
├─────────────────────────────────────────┤
│                                         │
│          質問タイトル                    │
│                                         │
│  ┌─────────────────────────────────┐  │
│  │       選択肢1                    │  │
│  ├─────────────────────────────────┤  │
│  │       選択肢2                    │  │
│  ├─────────────────────────────────┤  │
│  │       選択肢3                    │  │
│  └─────────────────────────────────┘  │
│                                         │
│     [ 前へ ]        [ 次へ ]           │
│                                         │
└─────────────────────────────────────────┘
```

## 📝 質問構成

### 質問リスト（10問）

1. **現在のWebサイトの状況** - 新規制作/リニューアル/追加制作/移行
2. **プロジェクトの目的** - 企業サイト/LP/ECサイト/ポートフォリオ/ブログ
3. **メインターゲット層** - BtoB/BtoC/両方/社内向け
4. **希望納期** - 1ヶ月以内/2-3ヶ月/3ヶ月以上/未定
5. **予算感** - 10万円以下/10-20万円/20-50万円/50万円以上/相談
6. **必要な機能**（複数選択可） - フォーム/CMS/予約/決済/会員/多言語
7. **デザインの方向性** - モダン/クラシック/クリエイティブ/ミニマル/テンプレート
8. **更新頻度** - 毎日/週1-2回/月1-2回/ほとんどしない
9. **制作後のサポート** - フルサポート/部分サポート/研修のみ/不要
10. **コンテンツの準備状況** - 準備済み/一部準備/これから/制作依頼

## 💡 診断ロジック

### スコアリングシステム

```javascript
// 各プランのスコアを計算
let lpScore = 0;      // ランディングページ
let webScore = 0;     // Webサイト
let wpScore = 0;      // WordPress

// 条件によるスコア加算例
if (purpose === 'lp') lpScore += 3;
if (purpose === 'corporate') webScore += 2;
if (purpose === 'blog' || purpose === 'ec') wpScore += 3;
```

### 推奨プラン

| プラン | 価格 | 主な特徴 |
|--------|------|----------|
| **ランディングページ** | ¥100,000〜 | 1ページ完結型、コンバージョン重視 |
| **Webサイト制作** | ¥150,000〜 | 5-10ページ、企業サイト向け |
| **WordPress制作** | ¥200,000〜 | CMS付き、更新頻度の高いサイト向け |

## 🔧 技術実装

### ファイル構成
```
needs-diagnosis.html     # メインHTML
├── css/
│   ├── base.css        # ヘッダー共通スタイル
│   └── needs-diagnosis.css  # 診断ツール専用スタイル
└── js/
    ├── common.js       # ヘッダー共通JS
    └── needs-diagnosis.js   # 診断ツール専用JS
```

### データ保存

#### LocalStorage構造
```javascript
{
  "diagnosis_progress": {
    "currentIndex": 3,        // 現在の質問番号
    "answers": {               // 回答データ
      "current_site": "new",
      "purpose": "corporate",
      "target": "btob"
    },
    "timestamp": 1234567890    // 保存時刻
  },
  "diagnosisResult": {         // 診断結果
    "answers": {...},
    "recommendation": {
      "plan": "WordPress制作プラン",
      "price": "¥200,000〜",
      "type": "wordpress"
    },
    "timestamp": "2024-01-01T00:00:00.000Z"
  }
}
```

### ブラウザ履歴管理

```javascript
// History API使用
history.pushState(state, '', `#question-${index + 1}`);

// URLパターン
#welcome          // ウェルカム画面
#question-1       // 質問1
#question-10      // 質問10
```

## 🔗 他システムとの連携

### 料金計算機への遷移

診断結果を`pricing-calculator.html`に渡す：

```javascript
// URLパラメータで結果を送信
const params = new URLSearchParams({
    from: 'diagnosis',
    type: 'wordpress'  // 診断結果のプランタイプ
});
window.location.href = `pricing-calculator.html?${params}`;
```

### メール送信機能（未実装）

```javascript
async function sendResultByEmail() {
    // 現在はデモ実装
    // 実際の実装では以下が必要：
    // - バックエンドAPI
    // - メールテンプレート
    // - PDF生成機能
}
```

## 🚀 カスタマイズガイド

### 質問の追加・変更

`questions`配列を編集（js/needs-diagnosis.js 11-127行目）：

```javascript
const questions = [
    {
        id: 'new_question',
        title: '新しい質問のタイトル',
        type: 'single',  // または 'multiple'
        options: [
            { value: 'opt1', label: 'オプション1', description: '説明' }
        ]
    }
];
```

### スコアリング調整

`calculateRecommendation`関数を編集（450-550行目）

### デザインカスタマイズ

CSS変数を変更（css/needs-diagnosis.css 8-15行目）

## 📊 パフォーマンス最適化

### 実施済み
- ✅ 外部ファイル化（CSS/JS分離）
- ✅ 不要なCSSリセット削除
- ✅ 重複コードの統合
- ✅ メッセージ表示関数の共通化

### 今後の改善点
- ⚠️ DOM要素のキャッシュ化
- ⚠️ event.currentTargetのバグ修正
- ⚠️ タイムアウト値の定数化
- ⚠️ ARIA属性の実装確認

## 📱 レスポンシブ対応

### ブレークポイント
- **768px以下**: モバイル表示
  - ボタンが縦並び（次へが上、前へが下）
  - 質問の特徴カードが1列表示
  - フォントサイズの調整

## 🐛 既知の問題と対処

### 修正済み
- ✅ classList.contains()のドット問題
- ✅ ボタン表示の復元バグ
- ✅ フェードアニメーションの不具合

### 未解決
- ⚠️ event未定義エラーの可能性（selectOption関数）
- ⚠️ ARIA属性が正しく動作していない可能性

## 📝 メンテナンスメモ

最終更新: 2024年
- CSSとJSを個別ファイルに分離
- 重複コードを削減（約50行）
- メッセージ表示関数を共通化