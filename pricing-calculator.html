<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>料金自動計算機 - Webサイト制作</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            font-size: 16px;
            background: #0a0a0a;
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden; /* 横スクロールを防ぐ */
        }
        
        html {
            scroll-behavior: smooth;
        }

        /* BEMブロック: pricing-calculator */
        .pricing-calculator {
            max-width: 1200px;
            margin: 0 auto;
            /* overflow: hidden; を削除してstickyを有効化 */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        /* pricing-calculator__header */
        .pricing-calculator__header {
            text-align: center;
            margin-bottom: 50px;
            padding: 80px 20px 0;
        }

        .pricing-calculator__title {
            font-size: 2rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 15px;
        }

        .pricing-calculator__subtitle {
            color: #a0a0a0;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* pricing-calculator__content */
        .pricing-calculator__content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            align-items: start; /* 重要: sticky動作のために必要 */
        }

        /* pricing-calculator__form */
        .pricing-calculator__form {
            padding: 0;
            background: rgba(255, 255, 255, 0.02);
        }

        /* pricing-calculator__result */
        .pricing-calculator__result {
            padding: 40px;
            background: rgba(255, 255, 255, 0.05);
            position: relative; /* sticky の基準となる位置を設定 */
        }
        
        /* sticky-container - 3つの要素のみを追従させる */
        .pricing-calculator__sticky-container {
            position: -webkit-sticky; /* Safari対応 */
            position: sticky;
            top: 40px;
            z-index: 10;
        }

        /* pricing-calculator__form-group */
        .pricing-calculator__form-group {
            background: #1a1a1a;
            padding: 25px;
            margin-bottom: 0;
            border: 1px solid #333;
            border-bottom: none;
            transition: all 0.3s ease;
            position: relative;
        }

        .pricing-calculator__form-group:last-child {
            border-bottom: 1px solid #333;
        }

        .pricing-calculator__form-title {
            color: #00ff88;
            font-size: 1.2rem;
            margin-bottom: 12px;
            font-weight: 600;
        }

        /* pricing-calculator__options */
        .pricing-calculator__options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0;
        }

        /* pricing-calculator__option */
        .pricing-calculator__option {
            position: relative;
        }

        .pricing-calculator__option-input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .pricing-calculator__option-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: none;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .pricing-calculator__option:first-child .pricing-calculator__option-label {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .pricing-calculator__option-label:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
        }

        .pricing-calculator__option-input:checked + .pricing-calculator__option-label {
            background: rgba(255, 255, 255, 0.08);
            border-color: #333;
        }

        .pricing-calculator__option-input:checked + .pricing-calculator__option-label::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #00ff88;
        }

        .pricing-calculator__option-content {
            flex: 1;
        }

        .pricing-calculator__option-title {
            font-weight: 500;
            color: #fff;
        }

        .pricing-calculator__option-description {
            font-size: 0.9rem;
            color: #aaa;
            margin-top: 2px;
        }

        .pricing-calculator__option-price {
            font-weight: 600;
            color: #00ff88;
            font-size: 1.1rem;
        }

        /* pricing-calculator__price-display */
        .pricing-calculator__price-display {
            background: transparent;
            color: #00ff88;
            padding: 40px;
            margin-bottom: 30px;
            width: 100%;
            border: 1px solid #00ff88;
        }

        .pricing-calculator__price-label {
            font-size: 1.1rem;
            margin-bottom: 10px;
            opacity: 0.8;
        }

        .pricing-calculator__total-price {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            transition: all 0.5s ease;
        }

        .pricing-calculator__tax-note {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* pricing-calculator__breakdown */
        .pricing-calculator__breakdown {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin-bottom: 20px;
            width: 100%;
        }

        .pricing-calculator__breakdown-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .pricing-calculator__breakdown-item:last-child {
            border-bottom: none;
            font-weight: 600;
            color: #00ff88;
            font-size: 1.1rem;
        }

        /* pricing-calculator__actions */
        .pricing-calculator__actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: flex-start;
            width: 100%;
        }

        .pricing-calculator__button {
            padding: 18px 40px;
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
            border: 2px solid rgba(0, 255, 136, 0.3);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            display: inline-block;
            flex: 1;
            text-align: center;
            backdrop-filter: blur(10px);
            white-space: nowrap;
        }

        .pricing-calculator__button:hover {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
        }

        .pricing-calculator__button--secondary {
            background: transparent;
            color: #fff;
            border-color: rgba(255, 255, 255, 0.3);
            font-size: 1rem;
            padding: 18px 30px;
        }

        .pricing-calculator__button--secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border-color: #fff;
        }

        /* アニメーション */

        .pricing-calculator__total-price--count-up {
            animation: countUp 0.8s ease-out;
        }

        @keyframes countUp {
            0% { 
                transform: scale(0.5) rotateX(90deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.1) rotateX(0deg);
                opacity: 0.8;
            }
            100% { 
                transform: scale(1) rotateX(0deg);
                opacity: 1;
            }
        }

        /* レスポンシブ対応 */
        @media (max-width: 768px) {
            .pricing-calculator__content {
                grid-template-columns: 1fr;
            }
            
            .pricing-calculator__form {
                padding-bottom: 60px;
            }
            
            .pricing-calculator__result {
                padding: 0;
            }
            
            .pricing-calculator__sticky-container {
                position: static;
            }
            
            .pricing-calculator__price-display {
                position: fixed;
                bottom: 20px;
                /* left, right, widthはJavaScriptで動的に設定 */
                z-index: 100;
                background: #0a0a0a;
                color: #00ff88;
                padding: 40px;
                margin: 0;
                border: 1px solid #00ff88;
                box-sizing: border-box;
                transition: none;
            }
            
            .pricing-calculator__price-display--in-place {
                position: static;
                background: transparent;
                left: auto;
                right: auto;
                bottom: auto;
                margin: 0 auto;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .pricing-calculator__header {
                padding: 40px 15px 0;
            }

            .pricing-calculator__title {
                font-size: 1.5rem;
            }

            .pricing-calculator__subtitle {
                font-size: 1rem;
            }

            .pricing-calculator__option-label {
                padding: 12px 15px;
            }

            .pricing-calculator__total-price {
                font-size: 2rem;
            }
        }

        /* モーダルのスタイル */
        .quote-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
        }

        .quote-modal--active {
            display: block;
        }

        .quote-modal__overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .quote-modal__content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1a1a1a;
            border: 1px solid #333;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -45%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .quote-modal__close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 30px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .quote-modal__close:hover {
            color: #00ff88;
            transform: rotate(90deg);
        }

        .quote-modal__title {
            color: #00ff88;
            font-size: 1.8rem;
            margin: 0 0 10px 0;
            padding: 30px 30px 0;
        }

        .quote-modal__subtitle {
            color: #aaa;
            font-size: 1rem;
            margin: 0 0 30px 0;
            padding: 0 30px;
        }

        .quote-modal__form {
            padding: 0 30px 30px;
        }

        .quote-modal__summary {
            background: rgba(0, 255, 136, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.2);
            padding: 20px;
            margin-bottom: 30px;
        }

        .quote-modal__summary h3 {
            color: #00ff88;
            font-size: 1.1rem;
            margin: 0 0 15px 0;
        }

        .quote-modal__summary-content {
            color: #ddd;
            font-size: 0.9rem;
            line-height: 1.8;
            max-height: 150px;
            overflow-y: auto;
        }

        .quote-modal__summary-total {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 255, 136, 0.3);
            color: #fff;
            font-size: 1.2rem;
            font-weight: 600;
            text-align: right;
        }

        .quote-modal__summary-total span {
            color: #00ff88;
        }

        .quote-modal__inputs {
            margin-bottom: 30px;
        }

        .quote-modal__field {
            margin-bottom: 20px;
        }

        .quote-modal__label {
            display: block;
            color: #fff;
            font-size: 0.95rem;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .quote-modal__required {
            color: #00ff88;
        }

        .quote-modal__input,
        .quote-modal__textarea {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .quote-modal__input:focus,
        .quote-modal__textarea:focus {
            outline: none;
            border-color: #00ff88;
            background: rgba(255, 255, 255, 0.08);
        }

        .quote-modal__textarea {
            resize: vertical;
            min-height: 80px;
        }

        .quote-modal__checkbox-label {
            display: flex;
            align-items: center;
            color: #ddd;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .quote-modal__checkbox-label input {
            margin-right: 8px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .quote-modal__actions {
            display: flex;
            gap: 15px;
        }

        .quote-modal__submit {
            flex: 1;
            padding: 18px 40px;
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
            border: 2px solid rgba(0, 255, 136, 0.3);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .quote-modal__submit:hover {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
        }

        .quote-modal__cancel {
            flex: 1;
            padding: 15px 30px;
            background: transparent;
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quote-modal__cancel:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #fff;
        }

        /* 成功メッセージ */
        .quote-modal__success {
            text-align: center;
            padding: 50px 30px;
        }

        .quote-modal__success-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 30px;
            background: #00ff88;
            color: #0a0a0a;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            animation: successPulse 0.5s ease;
        }

        @keyframes successPulse {
            0% {
                transform: scale(0);
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
            }
        }

        .quote-modal__success h3 {
            color: #fff;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        .quote-modal__success p {
            color: #ddd;
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .quote-modal__success p span {
            color: #00ff88;
            font-weight: 600;
        }

        .quote-modal__close-success {
            margin-top: 30px;
            padding: 12px 40px;
            background: #00ff88;
            color: #0a0a0a;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quote-modal__close-success:hover {
            background: #00cc6a;
        }

        /* ローディングスピナー */
        .quote-modal__spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(0, 255, 136, 0.2);
            border-top-color: #00ff88;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .quote-modal__submit-loading {
            display: inline-flex;
            align-items: center;
        }

        .quote-modal__submit[disabled] {
            opacity: 0.5;
            cursor: not-allowed;
            background: rgba(0, 255, 136, 0.05);
        }

        /* エラーメッセージ */
        .quote-modal__error {
            text-align: center;
            padding: 50px 30px;
        }

        .quote-modal__error-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 30px;
            background: #e74c3c;
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }

        .quote-modal__error h3 {
            color: #e74c3c;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        .quote-modal__error p {
            color: #ddd;
            font-size: 1rem;
            margin-bottom: 30px;
        }

        .quote-modal__retry {
            padding: 12px 40px;
            background: #e74c3c;
            color: #fff;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quote-modal__retry:hover {
            background: #c0392b;
        }

        /* カスタムスクロールバー */
        /* Webkit系ブラウザ（Chrome、Edge、Safari）用 */
        .quote-modal__content::-webkit-scrollbar,
        .quote-modal__summary-content::-webkit-scrollbar,
        .quote-modal__textarea::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .quote-modal__content::-webkit-scrollbar-track,
        .quote-modal__summary-content::-webkit-scrollbar-track,
        .quote-modal__textarea::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-left: 1px solid #333;
        }

        .quote-modal__content::-webkit-scrollbar-thumb,
        .quote-modal__summary-content::-webkit-scrollbar-thumb,
        .quote-modal__textarea::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 136, 0.3);
            border: none;
            transition: background 0.3s ease;
        }

        .quote-modal__content::-webkit-scrollbar-thumb:hover,
        .quote-modal__summary-content::-webkit-scrollbar-thumb:hover,
        .quote-modal__textarea::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 255, 136, 0.6);
        }

        .quote-modal__content::-webkit-scrollbar-thumb:active,
        .quote-modal__summary-content::-webkit-scrollbar-thumb:active,
        .quote-modal__textarea::-webkit-scrollbar-thumb:active {
            background: #00ff88;
        }

        /* Firefox用 */
        .quote-modal__content,
        .quote-modal__summary-content,
        .quote-modal__textarea {
            scrollbar-width: thin;
            scrollbar-color: rgba(0, 255, 136, 0.3) #1a1a1a;
        }

        .quote-modal__content:hover,
        .quote-modal__summary-content:hover,
        .quote-modal__textarea:hover {
            scrollbar-color: rgba(0, 255, 136, 0.6) #1a1a1a;
        }

        /* レスポンシブ対応 */
        @media (max-width: 768px) {
            .quote-modal__content {
                width: 95%;
                max-height: 95vh;
            }

            .quote-modal__title {
                font-size: 1.5rem;
                padding: 20px 20px 0;
            }

            .quote-modal__subtitle {
                padding: 0 20px;
            }

            .quote-modal__form {
                padding: 0 20px 20px;
            }

            .quote-modal__actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="pricing-calculator">
        <div class="pricing-calculator__header">
            <h1 class="pricing-calculator__title">料金自動計算機</h1>
            <p class="pricing-calculator__subtitle">あなたのプロジェクトに最適な料金を自動で算出いたします</p>
        </div>

        <div class="pricing-calculator__content">
            <div class="pricing-calculator__form">
                <!-- ページ数選択 -->
                <div class="pricing-calculator__form-group">
                    <h3 class="pricing-calculator__form-title">ページ数</h3>
                    <div class="pricing-calculator__options">
                        <div class="pricing-calculator__option">
                            <input type="radio" id="pages-1" name="pages" value="1" class="pricing-calculator__option-input" checked>
                            <label for="pages-1" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">1ページ（LP）</div>
                                    <div class="pricing-calculator__option-description">ランディングページ・単体ページ</div>
                                </div>
                                <div class="pricing-calculator__option-price">¥100,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="radio" id="pages-5" name="pages" value="5" class="pricing-calculator__option-input">
                            <label for="pages-5" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">5ページ</div>
                                    <div class="pricing-calculator__option-description">コーポレートサイト・小規模</div>
                                </div>
                                <div class="pricing-calculator__option-price">¥150,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="radio" id="pages-10" name="pages" value="10" class="pricing-calculator__option-input">
                            <label for="pages-10" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">10ページ</div>
                                    <div class="pricing-calculator__option-description">中規模サイト・充実したコンテンツ</div>
                                </div>
                                <div class="pricing-calculator__option-price">¥200,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="radio" id="pages-custom" name="pages" value="custom" class="pricing-calculator__option-input">
                            <label for="pages-custom" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">10ページ以上</div>
                                    <div class="pricing-calculator__option-description">大規模サイト・個別相談</div>
                                </div>
                                <div class="pricing-calculator__option-price">お見積り</div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- デザイン複雑度 -->
                <div class="pricing-calculator__form-group">
                    <h3 class="pricing-calculator__form-title">デザイン複雑度</h3>
                    <div class="pricing-calculator__options">
                        <div class="pricing-calculator__option">
                            <input type="radio" id="design-template" name="design" value="template" class="pricing-calculator__option-input" checked>
                            <label for="design-template" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">テンプレートベース</div>
                                    <div class="pricing-calculator__option-description">既存デザインをカスタマイズ</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥0</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="radio" id="design-custom" name="design" value="custom" class="pricing-calculator__option-input">
                            <label for="design-custom" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">オリジナルデザイン</div>
                                    <div class="pricing-calculator__option-description">完全オリジナルの制作</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥30,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="radio" id="design-premium" name="design" value="premium" class="pricing-calculator__option-input">
                            <label for="design-premium" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">プレミアムデザイン</div>
                                    <div class="pricing-calculator__option-description">高度なアニメーション・インタラクション</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥50,000</div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- ページ・コンテンツ関連 -->
                <div class="pricing-calculator__form-group">
                    <h3 class="pricing-calculator__form-title">ページ・コンテンツ関連</h3>
                    <div class="pricing-calculator__options">
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-add-page" name="features" value="add-page" class="pricing-calculator__option-input">
                            <label for="feature-add-page" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">1ページ追加</div>
                                    <div class="pricing-calculator__option-description">既存サイトにページを1つ追加</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥10,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-lp-extension" name="features" value="lp-extension" class="pricing-calculator__option-input">
                            <label for="feature-lp-extension" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">LPの長さ延長</div>
                                    <div class="pricing-calculator__option-description">ランディングページのコンテンツ量を増加</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥3,000</div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- フォーム機能 -->
                <div class="pricing-calculator__form-group">
                    <h3 class="pricing-calculator__form-title">フォーム機能</h3>
                    <div class="pricing-calculator__options">
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-contact-form" name="features" value="contact-form" class="pricing-calculator__option-input">
                            <label for="feature-contact-form" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">お問い合わせフォーム</div>
                                    <div class="pricing-calculator__option-description">氏名、メール、内容の基本フォーム</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥10,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-booking-form" name="features" value="booking-form" class="pricing-calculator__option-input">
                            <label for="feature-booking-form" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">予約フォーム</div>
                                    <div class="pricing-calculator__option-description">日時選択、カレンダー機能付きフォーム</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥20,000</div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- コンテンツ管理システム -->
                <div class="pricing-calculator__form-group">
                    <h3 class="pricing-calculator__form-title">コンテンツ管理システム</h3>
                    <div class="pricing-calculator__options">
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-basic-cms" name="features" value="basic-cms" class="pricing-calculator__option-input">
                            <label for="feature-basic-cms" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">基本CMS（ブログ機能）</div>
                                    <div class="pricing-calculator__option-description">記事投稿・編集・削除機能</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥20,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-advanced-cms" name="features" value="advanced-cms" class="pricing-calculator__option-input">
                            <label for="feature-advanced-cms" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">高度なCMS（カテゴリ・タグ管理）</div>
                                    <div class="pricing-calculator__option-description">分類機能付き高機能CMS</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥10,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-news" name="features" value="news" class="pricing-calculator__option-input">
                            <label for="feature-news" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">ニュース・お知らせ機能</div>
                                    <div class="pricing-calculator__option-description">簡易的な更新情報システム</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥10,000</div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- 外部サービス連携 -->
                <div class="pricing-calculator__form-group">
                    <h3 class="pricing-calculator__form-title">外部サービス連携</h3>
                    <div class="pricing-calculator__options">
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-sns" name="features" value="sns" class="pricing-calculator__option-input">
                            <label for="feature-sns" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">SNS連携（Instagram/Twitter）</div>
                                    <div class="pricing-calculator__option-description">投稿の自動表示・共有機能</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥5,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-maps" name="features" value="maps" class="pricing-calculator__option-input">
                            <label for="feature-maps" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">Google Maps連携</div>
                                    <div class="pricing-calculator__option-description">地図表示</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥5,000</div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- SEO・マーケティング -->
                <div class="pricing-calculator__form-group">
                    <h3 class="pricing-calculator__form-title">SEO・マーケティング</h3>
                    <div class="pricing-calculator__options">
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-seo" name="features" value="seo" class="pricing-calculator__option-input">
                            <label for="feature-seo" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">基本SEO対策</div>
                                    <div class="pricing-calculator__option-description">メタタグ、基本的な最適化</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥10,000</div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- UI/UX・視覚効果 -->
                <div class="pricing-calculator__form-group">
                    <h3 class="pricing-calculator__form-title">UI/UX・視覚効果</h3>
                    <div class="pricing-calculator__options">
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-slider" name="features" value="slider" class="pricing-calculator__option-input">
                            <label for="feature-slider" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">スライダー・カルーセル</div>
                                    <div class="pricing-calculator__option-description">画像やコンテンツのスライド表示</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥15,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-animation" name="features" value="animation" class="pricing-calculator__option-input">
                            <label for="feature-animation" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">アニメーション効果</div>
                                    <div class="pricing-calculator__option-description">CSS・JavaScriptアニメーション</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥20,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-parallax" name="features" value="parallax" class="pricing-calculator__option-input">
                            <label for="feature-parallax" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">パララックス効果</div>
                                    <div class="pricing-calculator__option-description">スクロール連動の視差効果</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥20,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-modal" name="features" value="modal" class="pricing-calculator__option-input">
                            <label for="feature-modal" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">モーダル・ライトボックス</div>
                                    <div class="pricing-calculator__option-description">ポップアップ表示機能</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥20,000</div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- WordPress機能・プラグイン -->
                <div class="pricing-calculator__form-group">
                    <h3 class="pricing-calculator__form-title">WordPress機能・プラグイン</h3>
                    <div class="pricing-calculator__options">
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-wp-acf" name="features" value="wp-acf" class="pricing-calculator__option-input">
                            <label for="feature-wp-acf" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">高機能エディタ導入</div>
                                    <div class="pricing-calculator__option-description">Advanced Custom Fields設定</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥15,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-wp-faq" name="features" value="wp-faq" class="pricing-calculator__option-input">
                            <label for="feature-wp-faq" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">FAQ作成</div>
                                    <div class="pricing-calculator__option-description">プラグインを使用せずに作成</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥10,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-wp-woo-basic" name="features" value="wp-woo-basic" class="pricing-calculator__option-input">
                            <label for="feature-wp-woo-basic" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">WooCommerce基本設定</div>
                                    <div class="pricing-calculator__option-description">商品登録・基本設定</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥25,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-wp-woo-payment" name="features" value="wp-woo-payment" class="pricing-calculator__option-input">
                            <label for="feature-wp-woo-payment" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">WooCommerce決済設定</div>
                                    <div class="pricing-calculator__option-description">PayPal、Stripe連携</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥15,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-wp-membership" name="features" value="wp-membership" class="pricing-calculator__option-input">
                            <label for="feature-wp-membership" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">会員制サイト構築</div>
                                    <div class="pricing-calculator__option-description">MemberPress、Restrict Content Pro</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥35,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-wp-yoast" name="features" value="wp-yoast" class="pricing-calculator__option-input">
                            <label for="feature-wp-yoast" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">Yoast SEO設定</div>
                                    <div class="pricing-calculator__option-description">基本SEO設定・サイトマップ</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥10,000</div>
                            </label>
                        </div>
                        <div class="pricing-calculator__option">
                            <input type="checkbox" id="feature-wp-polylang" name="features" value="wp-polylang" class="pricing-calculator__option-input">
                            <label for="feature-wp-polylang" class="pricing-calculator__option-label">
                                <div class="pricing-calculator__option-content">
                                    <div class="pricing-calculator__option-title">Polylang設定</div>
                                    <div class="pricing-calculator__option-description">無料多言語プラグイン</div>
                                </div>
                                <div class="pricing-calculator__option-price">+¥15,000</div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pricing-calculator__result">
                <div class="pricing-calculator__sticky-container">
                    <div class="pricing-calculator__price-display">
                        <div class="pricing-calculator__price-label">お見積り金額（税別価格）</div>
                        <div class="pricing-calculator__total-price" id="totalPrice">¥100,000</div>
                        <div class="pricing-calculator__tax-note">別途消費税</div>
                    </div>

                    <div class="pricing-calculator__breakdown">
                        <div id="breakdownItems">
                            <div class="pricing-calculator__breakdown-item">
                                <span>基本料金 (1ページ)</span>
                                <span>¥100,000</span>
                            </div>
                            <div class="pricing-calculator__breakdown-item">
                                <span>デザイン</span>
                                <span>¥0</span>
                            </div>
                            <div class="pricing-calculator__breakdown-item">
                                <span>追加機能</span>
                                <span>¥0</span>
                            </div>
                            <div class="pricing-calculator__breakdown-item">
                                <span><strong>合計金額</strong></span>
                                <span><strong>¥100,000</strong></span>
                            </div>
                        </div>
                    </div>

                    <div class="pricing-calculator__actions">
                        <button class="pricing-calculator__button" onclick="requestQuote()">正式見積りを依頼</button>
                        <button class="pricing-calculator__button pricing-calculator__button--secondary" onclick="generateEstimatePDF()">PDF見積書ダウンロード</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PDF生成用ライブラリ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- PDF生成モジュール（モダンデザイン版） -->
    <script src="js/pdf-generator/pdf-generator-modern.js"></script>

    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <!-- 見積もり依頼モーダル -->
    <div id="quoteModal" class="quote-modal">
        <div class="quote-modal__overlay"></div>
        <div class="quote-modal__content">
            <button class="quote-modal__close">&times;</button>
            <h2 class="quote-modal__title">正式見積りのご依頼</h2>
            <p class="quote-modal__subtitle">選択された内容で正式なお見積りをお送りします</p>

            <form id="quoteForm" class="quote-modal__form">
                <!-- 選択内容の表示 -->
                <div class="quote-modal__summary">
                    <h3>選択された内容</h3>
                    <div id="selectedItemsSummary" class="quote-modal__summary-content">
                        <!-- JavaScriptで動的に挿入 -->
                    </div>
                    <div class="quote-modal__summary-total">
                        概算金額: <span id="modalTotalPrice">¥0</span>
                    </div>
                </div>

                <!-- 入力フォーム -->
                <div class="quote-modal__inputs">
                    <div class="quote-modal__field">
                        <label for="customerName" class="quote-modal__label">
                            お名前 <span class="quote-modal__required">*</span>
                        </label>
                        <input type="text" id="customerName" name="customerName" required class="quote-modal__input">
                    </div>

                    <div class="quote-modal__field">
                        <label for="companyName" class="quote-modal__label">
                            会社名
                        </label>
                        <input type="text" id="companyName" name="companyName" class="quote-modal__input">
                    </div>

                    <div class="quote-modal__field">
                        <label for="customerEmail" class="quote-modal__label">
                            メールアドレス <span class="quote-modal__required">*</span>
                        </label>
                        <input type="email" id="customerEmail" name="customerEmail" required class="quote-modal__input">
                    </div>

                    <div class="quote-modal__field">
                        <label for="customerPhone" class="quote-modal__label">
                            電話番号
                        </label>
                        <input type="tel" id="customerPhone" name="customerPhone" class="quote-modal__input">
                    </div>

                    <div class="quote-modal__field">
                        <label for="projectDeadline" class="quote-modal__label">
                            希望納期
                        </label>
                        <input type="date" id="projectDeadline" name="projectDeadline" class="quote-modal__input">
                    </div>

                    <div class="quote-modal__field">
                        <label for="additionalMessage" class="quote-modal__label">
                            その他ご要望
                        </label>
                        <textarea id="additionalMessage" name="additionalMessage" rows="4" class="quote-modal__textarea"></textarea>
                    </div>

                    <div class="quote-modal__field">
                        <label class="quote-modal__checkbox-label">
                            <input type="checkbox" id="privacyAgree" name="privacyAgree" required>
                            <span>プライバシーポリシーに同意する <span class="quote-modal__required">*</span></span>
                        </label>
                    </div>
                </div>

                <!-- 送信ボタン -->
                <div class="quote-modal__actions">
                    <button type="submit" class="quote-modal__submit" id="submitButton">
                        <span class="quote-modal__submit-text">見積りを依頼する</span>
                        <span class="quote-modal__submit-loading" style="display: none;">
                            <span class="quote-modal__spinner"></span>
                            送信中...
                        </span>
                    </button>
                    <button type="button" class="quote-modal__cancel">キャンセル</button>
                </div>
            </form>

            <!-- エラーメッセージ -->
            <div id="quoteError" class="quote-modal__error" style="display: none;">
                <div class="quote-modal__error-icon">⚠</div>
                <h3>送信エラー</h3>
                <p id="errorMessage">送信に失敗しました。もう一度お試しください。</p>
                <button class="quote-modal__retry">もう一度試す</button>
            </div>

            <!-- 送信完了メッセージ -->
            <div id="quoteSuccess" class="quote-modal__success" style="display: none;">
                <div class="quote-modal__success-icon">✓</div>
                <h3>お見積り依頼を受け付けました</h3>
                <p>受付番号: <span id="receiptNumber"></span></p>
                <p>1営業日以内に担当者よりご連絡いたします。</p>
                <button class="quote-modal__close-success">閉じる</button>
            </div>
        </div>
    </div>

    <script>
        /* ========================================
           EmailJS 設定手順（重要！）
           ========================================

           1. EmailJS アカウント作成
              - https://www.emailjs.com/ でサインアップ（無料）

           2. Email Service を追加
              - Dashboard > Email Services > Add New Service
              - Gmail または他のメールサービスを選択
              - Service ID をメモ（例: "service_abc123"）

           3. Email Template を作成
              - Dashboard > Email Templates > Create New Template
              - 以下の変数を使用:
                {{from_name}} - お客様名
                {{from_email}} - メールアドレス
                {{company_name}} - 会社名
                {{phone}} - 電話番号
                {{deadline}} - 希望納期
                {{selected_items}} - 選択項目
                {{total_price}} - 概算金額
                {{message}} - その他要望
                {{receipt_number}} - 受付番号
              - Template ID をメモ（例: "template_xyz789"）

           4. API Keys を確認
              - Dashboard > Account > API Keys
              - Public Key をメモ（例: "user_PublicKey123"）

           5. 下記の定数を実際の値に置き換える
              - EMAILJS_PUBLIC_KEY
              - EMAILJS_SERVICE_ID
              - EMAILJS_TEMPLATE_ID

           6. Netlify へデプロイ後
              - EmailJS Dashboard > Email Services > 設定
              - Whitelist domains に Netlify URL を追加
              （例: your-site.netlify.app）
        ======================================== */

        // EmailJS 設定（これらを実際の値に置き換えてください）
        const EMAILJS_PUBLIC_KEY = 'YOUR_PUBLIC_KEY';  // EmailJSのPublic Key
        const EMAILJS_SERVICE_ID = 'YOUR_SERVICE_ID';  // Service ID
        const EMAILJS_TEMPLATE_ID = 'YOUR_TEMPLATE_ID'; // Template ID

        // EmailJS 初期化
        (function() {
            emailjs.init(EMAILJS_PUBLIC_KEY);
        })();

        // 料金設定
        const pricingConfig = {
            pages: {
                1: 100000,
                5: 150000,
                10: 200000,
                custom: 0 // 個別相談
            },
            design: {
                template: 0,
                custom: 80000,
                premium: 180000
            },
            features: {
                'add-page': 10000,
                'lp-extension': 3000,
                'contact-form': 10000,
                'booking-form': 20000,
                'basic-cms': 20000,
                'advanced-cms': 10000,
                'news': 10000,
                'sns': 5000,
                'maps': 5000,
                'seo': 10000,
                'slider': 15000,
                'animation': 20000,
                'parallax': 20000,
                'modal': 20000,
                'wp-acf': 15000,
                'wp-faq': 10000,
                'wp-woo-basic': 25000,
                'wp-woo-payment': 15000,
                'wp-membership': 35000,
                'wp-yoast': 10000,
                'wp-polylang': 15000
            }
        };

        // DOM要素の取得（BEM記法準拠）
        const totalPriceElement = document.getElementById('totalPrice');
        const breakdownElement = document.getElementById('breakdownItems');

        // 計算機の初期化
        function initPricingCalculator() {
            updatePrice();
            attachEventListeners();
        }

        // イベントリスナーの設定
        function attachEventListeners() {
            // BEM記法のクラス名でセレクト
            const inputs = document.querySelectorAll('.pricing-calculator__option-input');
            inputs.forEach(input => {
                input.addEventListener('change', updatePrice);
            });
        }

        // 価格の更新
        function updatePrice() {
            const selectedPages = document.querySelector('input[name="pages"]:checked').value;
            const selectedDesign = document.querySelector('input[name="design"]:checked').value;
            const selectedFeatures = Array.from(document.querySelectorAll('input[name="features"]:checked'))
                .map(input => input.value);

            // 基本料金の計算
            let basePrice = pricingConfig.pages[selectedPages];
            let designPrice = pricingConfig.design[selectedDesign];
            let featuresPrice = selectedFeatures.reduce((total, feature) => {
                return total + pricingConfig.features[feature];
            }, 0);

            const totalPrice = basePrice + designPrice + featuresPrice;

            // アニメーション付きで価格を更新
            updatePriceWithAnimation(totalPrice);

            // 内訳の更新
            updateBreakdown(selectedPages, basePrice, designPrice, featuresPrice, selectedFeatures, totalPrice);
        }

        // アニメーション付きで価格を更新
        function updatePriceWithAnimation(newPrice) {
            totalPriceElement.classList.add('pricing-calculator__total-price--count-up');
            
            setTimeout(() => {
                if (newPrice === 0) {
                    totalPriceElement.textContent = 'お見積り';
                } else {
                    totalPriceElement.textContent = `¥${newPrice.toLocaleString()}`;
                }
                totalPriceElement.classList.remove('pricing-calculator__total-price--count-up');
            }, 100);
        }

        // 内訳の更新
        function updateBreakdown(selectedPages, basePrice, designPrice, featuresPrice, selectedFeatures, totalPrice) {
            const pageLabels = {
                1: '1ページ',
                5: '5ページ',
                10: '10ページ',
                custom: 'カスタム'
            };

            const designLabels = {
                template: 'テンプレートベース',
                custom: 'オリジナルデザイン',
                premium: 'プレミアムデザイン'
            };

            const featureLabels = {
                'add-page': '1ページ追加',
                'lp-extension': 'LPの長さ延長',
                'contact-form': 'お問い合わせフォーム',
                'booking-form': '予約フォーム',
                'basic-cms': '基本CMS（ブログ機能）',
                'advanced-cms': '高度なCMS',
                'news': 'ニュース・お知らせ機能',
                'sns': 'SNS連携',
                'maps': 'Google Maps連携',
                'seo': '基本SEO対策',
                'slider': 'スライダー・カルーセル',
                'animation': 'アニメーション効果',
                'parallax': 'パララックス効果',
                'modal': 'モーダル・ライトボックス',
                'wp-acf': '高機能エディタ導入',
                'wp-faq': 'FAQ作成',
                'wp-woo-basic': 'WooCommerce基本設定',
                'wp-woo-payment': 'WooCommerce決済設定',
                'wp-membership': '会員制サイト構築',
                'wp-yoast': 'Yoast SEO設定',
                'wp-polylang': 'Polylang設定'
            };

            let breakdownHTML = '';

            // 基本料金
            if (selectedPages === 'custom') {
                breakdownHTML += `
                    <div class="pricing-calculator__breakdown-item">
                        <span>基本料金 (${pageLabels[selectedPages]})</span>
                        <span>お見積り</span>
                    </div>
                `;
            } else {
                breakdownHTML += `
                    <div class="pricing-calculator__breakdown-item">
                        <span>基本料金 (${pageLabels[selectedPages]})</span>
                        <span>¥${basePrice.toLocaleString()}</span>
                    </div>
                `;
            }

            // デザイン料金
            const selectedDesignValue = document.querySelector('input[name="design"]:checked').value;
            breakdownHTML += `
                <div class="pricing-calculator__breakdown-item">
                    <span>デザイン (${designLabels[selectedDesignValue]})</span>
                    <span>¥${designPrice.toLocaleString()}</span>
                </div>
            `;

            // 機能料金
            if (selectedFeatures.length > 0) {
                selectedFeatures.forEach(feature => {
                    breakdownHTML += `
                        <div class="pricing-calculator__breakdown-item">
                            <span>${featureLabels[feature]}</span>
                            <span>¥${pricingConfig.features[feature].toLocaleString()}</span>
                        </div>
                    `;
                });
            } else {
                breakdownHTML += `
                    <div class="pricing-calculator__breakdown-item">
                        <span>追加機能</span>
                        <span>¥0</span>
                    </div>
                `;
            }

            // 合計
            if (selectedPages === 'custom') {
                breakdownHTML += `
                    <div class="pricing-calculator__breakdown-item">
                        <span><strong>合計金額</strong></span>
                        <span><strong>お見積り</strong></span>
                    </div>
                `;
            } else {
                breakdownHTML += `
                    <div class="pricing-calculator__breakdown-item">
                        <span><strong>合計金額</strong></span>
                        <span><strong>¥${totalPrice.toLocaleString()}</strong></span>
                    </div>
                `;
            }

            breakdownElement.innerHTML = breakdownHTML;
        }

        // モーダル関連の要素取得
        const modal = document.getElementById('quoteModal');
        const modalOverlay = document.querySelector('.quote-modal__overlay');
        const modalClose = document.querySelector('.quote-modal__close');
        const modalCancel = document.querySelector('.quote-modal__cancel');
        const quoteForm = document.getElementById('quoteForm');
        const quoteSuccess = document.getElementById('quoteSuccess');
        const closeSuccessBtn = document.querySelector('.quote-modal__close-success');

        // 正式見積りを依頼（モーダルを開く）
        function requestQuote() {
            // モーダルを開く
            openQuoteModal();

            // 選択内容を収集して表示
            updateModalSummary();
        }

        // モーダルを開く
        function openQuoteModal() {
            modal.classList.add('quote-modal--active');
            document.body.style.overflow = 'hidden';

            // フォームをリセット
            quoteForm.reset();
            quoteForm.style.display = 'block';
            quoteSuccess.style.display = 'none';
        }

        // モーダルを閉じる
        function closeQuoteModal() {
            modal.classList.remove('quote-modal--active');
            document.body.style.overflow = '';
        }

        // 選択内容をモーダルに反映
        function updateModalSummary() {
            const selectedPages = document.querySelector('input[name="pages"]:checked');
            const selectedDesign = document.querySelector('input[name="design"]:checked');
            const selectedFeatures = document.querySelectorAll('input[name="features"]:checked');

            let summaryHTML = '';

            // ページ数
            if (selectedPages) {
                const pageLabel = selectedPages.nextElementSibling.querySelector('.pricing-calculator__option-title').textContent;
                const pagePrice = selectedPages.nextElementSibling.querySelector('.pricing-calculator__option-price').textContent;
                summaryHTML += `<div class="quote-modal__summary-item">• ページ数: ${pageLabel} (${pagePrice})</div>`;
            }

            // デザイン
            if (selectedDesign) {
                const designLabel = selectedDesign.nextElementSibling.querySelector('.pricing-calculator__option-title').textContent;
                const designPrice = selectedDesign.nextElementSibling.querySelector('.pricing-calculator__option-price').textContent;
                if (designPrice !== '+¥0') {
                    summaryHTML += `<div class="quote-modal__summary-item">• デザイン: ${designLabel} (${designPrice})</div>`;
                }
            }

            // 追加機能
            selectedFeatures.forEach(feature => {
                const featureLabel = feature.nextElementSibling.querySelector('.pricing-calculator__option-title').textContent;
                const featurePrice = feature.nextElementSibling.querySelector('.pricing-calculator__option-price').textContent;
                summaryHTML += `<div class="quote-modal__summary-item">• ${featureLabel} (${featurePrice})</div>`;
            });

            // サマリーを更新
            document.getElementById('selectedItemsSummary').innerHTML = summaryHTML || '<div>選択された項目はありません</div>';

            // 合計金額を更新
            const totalPrice = document.getElementById('totalPrice').textContent;
            document.getElementById('modalTotalPrice').textContent = totalPrice;
        }

        // フォーム送信処理
        async function handleQuoteSubmit(e) {
            e.preventDefault();

            // ボタンをローディング状態にする
            const submitButton = document.getElementById('submitButton');
            const submitText = submitButton.querySelector('.quote-modal__submit-text');
            const submitLoading = submitButton.querySelector('.quote-modal__submit-loading');
            const quoteError = document.getElementById('quoteError');

            submitButton.disabled = true;
            submitText.style.display = 'none';
            submitLoading.style.display = 'inline-flex';
            quoteError.style.display = 'none';

            // フォームデータを取得
            const formData = new FormData(quoteForm);
            const customerName = formData.get('customerName');
            const companyName = formData.get('companyName') || '(未入力)';
            const customerEmail = formData.get('customerEmail');
            const customerPhone = formData.get('customerPhone') || '(未入力)';
            const projectDeadline = formData.get('projectDeadline');
            const additionalMessage = formData.get('additionalMessage') || '(なし)';

            // 選択内容を取得
            const selectedItems = Array.from(document.querySelectorAll('#selectedItemsSummary .quote-modal__summary-item'))
                .map(item => item.textContent).join('\n');
            const totalPrice = document.getElementById('modalTotalPrice').textContent;

            // 見積もり番号を生成
            const receiptNumber = generateReceiptNumber();

            // EmailJS用のテンプレートパラメータ
            const templateParams = {
                from_name: customerName,
                from_email: customerEmail,
                company_name: companyName,
                phone: customerPhone,
                deadline: projectDeadline ? new Date(projectDeadline).toLocaleDateString('ja-JP') : '(未指定)',
                selected_items: selectedItems,
                total_price: totalPrice,
                message: additionalMessage,
                receipt_number: receiptNumber,
                request_date: new Date().toLocaleString('ja-JP')
            };

            try {
                // EmailJSで送信
                if (EMAILJS_PUBLIC_KEY !== 'YOUR_PUBLIC_KEY') {
                    // EmailJSが設定されている場合
                    const response = await emailjs.send(
                        EMAILJS_SERVICE_ID,
                        EMAILJS_TEMPLATE_ID,
                        templateParams
                    );

                    console.log('EmailJS送信成功:', response);

                    // 成功画面を表示
                    showSuccessMessage(receiptNumber);
                } else {
                    // EmailJSが設定されていない場合はmailtoにフォールバック
                    console.warn('EmailJSが設定されていません。mailtoを使用します。');

                    const subject = `[見積依頼 #${receiptNumber}] Webサイト制作のお見積り`;
                    const body = `
【お見積り依頼】

受付番号: ${receiptNumber}
依頼日時: ${templateParams.request_date}

■ お客様情報
お名前: ${customerName}
会社名: ${companyName}
メールアドレス: ${customerEmail}
電話番号: ${customerPhone}

■ プロジェクト情報
希望納期: ${templateParams.deadline}

■ 選択された内容
${selectedItems}

概算金額: ${totalPrice}

■ その他ご要望
${additionalMessage}

---
このメールは料金自動計算機から送信されました。
`.trim();

                    const mailtoLink = `mailto:info@example.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                    window.location.href = mailtoLink;

                    // 成功画面を表示
                    showSuccessMessage(receiptNumber);
                }
            } catch (error) {
                console.error('送信エラー:', error);

                // エラー画面を表示
                document.getElementById('errorMessage').textContent =
                    error.text || '送信に失敗しました。もう一度お試しください。';
                quoteForm.style.display = 'none';
                quoteError.style.display = 'block';
            } finally {
                // ボタンを元に戻す
                submitButton.disabled = false;
                submitText.style.display = 'inline';
                submitLoading.style.display = 'none';
            }
        }

        // 受付番号を生成
        function generateReceiptNumber() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const random = String(Math.floor(Math.random() * 10000)).padStart(4, '0');
            return `${year}${month}${day}-${random}`;
        }

        // 成功メッセージを表示
        function showSuccessMessage(receiptNumber) {
            document.getElementById('receiptNumber').textContent = receiptNumber;
            quoteForm.style.display = 'none';
            quoteSuccess.style.display = 'block';
        }

        // イベントリスナーの設定
        modalClose.addEventListener('click', closeQuoteModal);
        modalOverlay.addEventListener('click', closeQuoteModal);
        modalCancel.addEventListener('click', closeQuoteModal);
        closeSuccessBtn.addEventListener('click', closeQuoteModal);
        quoteForm.addEventListener('submit', handleQuoteSubmit);

        // エラー時の「もう一度試す」ボタン
        document.querySelector('.quote-modal__retry').addEventListener('click', () => {
            document.getElementById('quoteError').style.display = 'none';
            quoteForm.style.display = 'block';
            quoteForm.reset();
            updateModalSummary();
        });

        // ESCキーでモーダルを閉じる
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('quote-modal--active')) {
                closeQuoteModal();
            }
        });

        // 右側パネルの高さを左側に合わせる関数
        function adjustResultPanelHeight() {
            const formElement = document.querySelector('.pricing-calculator__form');
            const resultElement = document.querySelector('.pricing-calculator__result');
            
            if (formElement && resultElement) {
                if (window.innerWidth <= 768) {
                    // モバイルではmin-heightを解除
                    resultElement.style.minHeight = '';
                } else {
                    // PC版では従来通り
                    const formHeight = formElement.offsetHeight;
                    resultElement.style.minHeight = formHeight + 'px';
                }
            }
        }
        
        // 動的CSS値検出ヘルパー関数
        function getActualPaddingValues() {
            const body = document.body;
            const resultElement = document.querySelector('.pricing-calculator__result');
            
            const bodyStyle = window.getComputedStyle(body);
            const resultStyle = window.getComputedStyle(resultElement);
            
            return {
                bodyPaddingLeft: parseFloat(bodyStyle.paddingLeft) || 0,
                bodyPaddingRight: parseFloat(bodyStyle.paddingRight) || 0,
                resultPaddingLeft: parseFloat(resultStyle.paddingLeft) || 0,
                resultPaddingRight: parseFloat(resultStyle.paddingRight) || 0
            };
        }

        // 価格表示の幅をbreakdownと同期する関数
        function syncPriceDisplayWidth() {
            const priceDisplay = document.querySelector('.pricing-calculator__price-display');
            const breakdown = document.querySelector('.pricing-calculator__breakdown');
            
            if (!priceDisplay || !breakdown || window.innerWidth > 768) return;
            
            // 現在の状態をチェックして適切な位置設定を適用
            if (priceDisplay.classList.contains('pricing-calculator__price-display--in-place')) {
                // 通常配置の時（position: static）
                // 幅設定をリセットしてCSSのデフォルト（width: 100%）を使用
                priceDisplay.style.width = '';
                priceDisplay.style.left = '';
                priceDisplay.style.right = '';
                priceDisplay.style.transform = '';
            } else {
                // 固定配置の時（position: fixed）
                // breakdownと同じ幅に設定して画面中央に配置
                const breakdownRect = breakdown.getBoundingClientRect();
                priceDisplay.style.width = breakdownRect.width + 'px';
                priceDisplay.style.left = '50%';
                priceDisplay.style.right = 'auto';
                priceDisplay.style.transform = 'translateX(-50%)';
            }
        }

        // モバイルで価格表示を下部固定/解除する処理
        function setupMobilePriceDisplay() {
            const priceDisplay = document.querySelector('.pricing-calculator__price-display');
            const resultContainer = document.querySelector('.pricing-calculator__result');
            
            if (!priceDisplay || !resultContainer) return;
            
            // モバイルサイズかチェック
            const isMobile = () => window.innerWidth <= 768;
            
            // IntersectionObserverを使用して本来の位置を監視
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (isMobile()) {
                        if (entry.isIntersecting) {
                            // 本来の位置が見えたら固定解除
                            priceDisplay.classList.add('pricing-calculator__price-display--in-place');
                        } else {
                            // 本来の位置が見えなくなったら下部固定
                            priceDisplay.classList.remove('pricing-calculator__price-display--in-place');
                        }
                        // スタイルを正しく更新
                        syncPriceDisplayWidth();
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '-100px 0px 0px 0px' // 上部100pxのマージンを設定
            });
            
            // 監視開始
            if (isMobile()) {
                observer.observe(resultContainer);
            }
            
            // ウィンドウリサイズ時の処理
            window.addEventListener('resize', () => {
                // 高さ調整も同時に実行
                adjustResultPanelHeight();
                // 幅も同期
                syncPriceDisplayWidth();
                
                if (!isMobile()) {
                    // PCサイズになったら固定解除とリセット
                    priceDisplay.classList.remove('pricing-calculator__price-display--in-place');
                    priceDisplay.style.left = '';
                    priceDisplay.style.right = '';
                    priceDisplay.style.width = '';
                    priceDisplay.style.transform = '';
                    observer.disconnect();
                } else {
                    // モバイルサイズになったら監視再開
                    observer.observe(resultContainer);
                    syncPriceDisplayWidth();
                }
            });
        }
        
        // ページ読み込み時に初期化
        document.addEventListener('DOMContentLoaded', () => {
            initPricingCalculator();
            adjustResultPanelHeight();
            setupMobilePriceDisplay();
            // 初期幅同期
            syncPriceDisplayWidth();
        });
    </script>
</body>
</html>